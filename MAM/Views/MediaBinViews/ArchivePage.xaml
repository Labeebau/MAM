<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MAM.Views.MediaBinViews.ArchivePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MAM.Views.MediaBinViews"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local1="using:MAM.UserControls"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    <Page.Resources>
        <MenuFlyout x:Key="ArchiveMenuFlyout">
            <MenuFlyoutItem x:Name="DeleteMenuItem" Text="Delete" Icon="Delete" Click="Delete_Click" IsEnabled="False"  />
            <MenuFlyoutItem x:Name="UnArchiveMenuItem" Text="UnArchive" Icon="Refresh"  Click="UnArchive_Click" IsEnabled="False" />
        </MenuFlyout>
        <!-- Grid View Template -->
        <DataTemplate x:Key="GridViewTemplate" x:DataType="local:MediaPlayerItem">
            <Border Background="Transparent" Padding="1"  >
                <local1:CustomBinMedia x:Name="customMediaPlayer" MediaItem="{Binding}" Loaded="CustomMediaPlayer_Loaded" />
            </Border>
        </DataTemplate>

        <!-- List View Template -->
        <DataTemplate x:Key="ListViewTemplate" x:DataType="local:MediaPlayerItem">
            <Border Padding="1" HorizontalAlignment="Stretch" Background="Transparent">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Thumbnail -->
                    <Image Source="{x:Bind ThumbnailPath}"
                             Width="100" Height="60"
                             VerticalAlignment="Center"
                             HorizontalAlignment="Left" />  

                    <!-- Text Content -->
                    <StackPanel   Grid.Column="1" Margin="10,0,0,0"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Left">
                        <TextBlock   Text="{x:Bind Title}"
                                     FontSize="14"
                                     TextWrapping="WrapWholeWords"
                                     TextAlignment="Left"
                                     HorizontalAlignment="Left"
                                     Width="300"/>
                        <!-- Add more info if needed -->
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>
        
        <!-- Tile View Template -->
        <DataTemplate x:Key="TileViewTemplate" x:DataType="local:MediaPlayerItem">
            <Border Padding="10" HorizontalAlignment="Stretch" Background="Transparent">
                <StackPanel Width="200" Height="150" Padding="10">
                    <Image Source="{x:Bind ThumbnailPath}" Stretch="UniformToFill" Height="100"/>
                    <TextBlock Text="{x:Bind Title}" TextWrapping="Wrap" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>
        </DataTemplate>

        <!-- Details View Template -->
        <DataTemplate x:Key="DetailsViewTemplate" x:DataType="local:MediaPlayerItem">
            <Border Padding="1" HorizontalAlignment="Stretch" Background="Transparent">

                <Grid Padding="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="50" />
                        <ColumnDefinition Width="400"/>
                        <ColumnDefinition Width="400"/>
                        <ColumnDefinition Width="400"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Image Grid.Column="0" Source="{x:Bind ThumbnailPath}" Width="40" Height="40" />
                    <TextBlock Grid.Column="1" 
                                 Text="{x:Bind Title}" 
                                 FontSize="14"
                                 VerticalAlignment="Center" 
                                 Padding="5,0,5,0" 
                                 TextWrapping="Wrap"
                                 TextTrimming="CharacterEllipsis" />
                    <TextBlock Grid.Column="2" 
                                 Text="{x:Bind MediaPath}" 
                                 VerticalAlignment="Center" 
                                 FontStyle="Italic" 
                                 Padding="5,0,5,0"
                                 TextWrapping="Wrap"
                                 TextTrimming="CharacterEllipsis"/>
                    <TextBlock Grid.Column="3" 
             Text="{x:Bind ArchivePath}" 
             VerticalAlignment="Center" 
             FontStyle="Italic" 
             Padding="5,0,5,0"
             TextWrapping="Wrap"
             TextTrimming="CharacterEllipsis"/>
                    <DropDownButton Grid.Column="4" 
                                      x:Name="TagsDropDown"
                                      Width="150" 
                                      HorizontalContentAlignment="Left"
                                      Background="Transparent"
                                      BorderThickness="1"
                                      BorderBrush="#221100"
                                      Content="{x:Bind Tags[0], Mode=OneWay}">
                        <DropDownButton.Flyout >
                            <Flyout x:Name="TagsFlyOut" 
                                      Placement="BottomEdgeAlignedLeft" 
                                      Opening="TagsFlyout_Opening"  >
                                <ListView x:Name="TagsListView" 
                                            ItemsSource="{x:Bind Tags}"
                                            HorizontalContentAlignment="Left">
                                </ListView>
                            </Flyout>
                        </DropDownButton.Flyout>
                    </DropDownButton>
                </Grid>
            </Border>
        </DataTemplate>
        
        <local:MediaTemplateSelector x:Key="MediaTemplateSelector"
                           GridViewTemplate="{StaticResource GridViewTemplate}"
                           ListViewTemplate="{StaticResource ListViewTemplate}"
                           TileViewTemplate="{StaticResource TileViewTemplate}"
                           DetailsViewTemplate="{StaticResource DetailsViewTemplate}" />
    </Page.Resources>

    <Grid x:Name="MainGrid" Background="{StaticResource ThemePrimaryBackgroundColor}" Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="LeftColumn" Width="300"/>
            <ColumnDefinition Width="10"/>
            <!-- Left Splitter -->
            <ColumnDefinition x:Name="CenterColumn" Width="*"/>
            <!--<ColumnDefinition Width="10"/>
            --><!-- Right Splitter --><!--
            <ColumnDefinition x:Name="RightColumn" Width="300"/>-->
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition x:Name="TopRow" Height="*"/>
            <RowDefinition Height="10"/>
            <!-- Horizontal Splitter -->
            <RowDefinition x:Name="BottomRow" Height="300"/>
        </Grid.RowDefinitions>


        <!-- Left Panel -->
        <Border x:Name="LeftPanel" Grid.Row="0" Grid.Column="0" Height="700"   Width="300"  >
            <Grid x:Name="LeftGrid">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="4*"/>
                            <RowDefinition Height="6*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0"  Orientation="Horizontal" >
                            <TextBox x:Name="txtSearch" PlaceholderText="Search Text..." Width="200" Height="20" Margin="20,0,0,0" VerticalAlignment="Center"/>
                            <Button x:Name="BtnSearch" Style="{StaticResource SmallIconButton}" 
                                    VerticalAlignment="Center" Click="BtnSearch_Click">
                                <FontIcon  Glyph="&#xf002;" />
                            </Button>
                        </StackPanel>

                        <StackPanel Grid.Row="1"  Orientation="Vertical" Margin="20,5,0,0" Spacing="10" >
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <TextBlock Text="Trim Point"/>
                                <TextBox x:Name="txtTrimPoint" Width="200" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="50">

                                <TextBlock Text="Tag"/>
                                <TextBox x:Name="txtTag" Width="200" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

        <Rectangle x:Name="LeftVerticalSplitter" Grid.Row="0" Grid.Column="1" Width="10" Height="700" 
                Fill="{StaticResource ThemeSecondaryBackgroundColor}"  
                IsHitTestVisible="True"  
                PointerPressed="VerticalSplitter_PointerPressed" 
                PointerMoved="VerticalSplitter_PointerMoved" 
                PointerReleased="Splitter_PointerReleased" 
                PointerEntered="VerticalSplitter_PointerEntered"
                PointerExited="VerticalSplitter_PointerExited"
                    />
        <!-- Right Panel -->
        <Border x:Name="CenterPanel"  Grid.Row="0" Grid.Column="2" Height="700" Width="auto"  Padding="20" >
            <Grid x:Name="CenterGrid"  Width="auto" Margin="20,0,0,0" >
                  <Grid.RowDefinitions>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="30"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" x:Name="txtSearchBin" Width="auto" Margin="0,0,0,0" Text="{x:Bind ViewModel.MediaObj.MediaPath,Mode=OneWay}"
HorizontalAlignment="Left"/>
                <Grid Grid.Row="1" x:Name="DetailsHeader"  Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80" />
                                <ColumnDefinition Width="400"/>
                                <ColumnDefinition Width="400"/>
                                <ColumnDefinition Width="400"/>
                        <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="" FontWeight="SemiBold" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1" Text="Title" FontWeight="SemiBold" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="2" Text="Original Path" FontWeight="SemiBold" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="3" Text="Archive Path" FontWeight="SemiBold" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="4" Text="Tags" FontWeight="SemiBold" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                        </Grid>
                
                <GridView x:Name="MediaBinGridView" Grid.Row="2" 
                                   ItemsSource="{x:Bind ViewModel.PagedMediaPlayerItems,Mode=TwoWay}"
                                   ItemTemplateSelector="{StaticResource MediaTemplateSelector}"
                                   HorizontalAlignment="Stretch"
                                   VerticalAlignment="Top"
                                   Height="560"
                                   SelectionMode="Extended"
                                   ContextFlyout="{StaticResource ArchiveMenuFlyout}"
                                   SelectionChanged="MediaBinGridView_SelectionChanged"
                                   PointerPressed="MediaBinGridView_PointerPressed"
                                   DoubleTapped="MediaBinGridView_DoubleTapped"
                                   RightTapped="MediaBinGridView_RightTapped">

                            <GridView.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="0" />
                                </ItemsPanelTemplate>
                            </GridView.ItemsPanel>
                            <GridView.ItemContainerStyle>
                                <Style TargetType="GridViewItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="GridViewItem">
                                                <Border x:Name="RootBorder"
                                                        Background="Transparent"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="4">
                                                    <ContentPresenter />

                                                    <!-- ðŸ‘‡ VisualStates now inside the Border -->
                                                    <VisualStateManager.VisualStateGroups>
                                                        <VisualStateGroup x:Name="CommonStates">
                                                            <VisualState x:Name="Normal"/>

                                                            <VisualState x:Name="PointerOver">
                                                                <VisualState.Setters>
                                                                    <Setter Target="RootBorder.Background" Value="DarkGray"/>
                                                                </VisualState.Setters>
                                                            </VisualState>

                                                            <VisualState x:Name="Pressed">
                                                                <VisualState.Setters>
                                                                    <Setter Target="RootBorder.Background" Value="DarkGray"/>
                                                                </VisualState.Setters>
                                                            </VisualState>

                                                            <VisualState x:Name="Selected">
                                                                <VisualState.Setters>
                                                                    <Setter Target="RootBorder.Background" Value="DeepSkyBlue" />
                                                                </VisualState.Setters>
                                                            </VisualState>

                                                            <VisualState x:Name="PointerOverSelected">
                                                                <VisualState.Setters>
                                                                    <Setter Target="RootBorder.Background" Value="DodgerBlue"/>
                                                                </VisualState.Setters>
                                                            </VisualState>
                                                        </VisualStateGroup>

                                                    </VisualStateManager.VisualStateGroups>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="UseSystemFocusVisuals" Value="False"/>
                                </Style>
                            </GridView.ItemContainerStyle>
                        </GridView>

                        <ComboBox x:Name="ViewModeComboBox" 
                                   Grid.Row="3"
                                   Margin="0,5,0,0"
                                   Width="65"
                                   SelectionChanged="ViewModeComboBox_SelectionChanged"
                                   HorizontalAlignment="Right">

                            <ComboBoxItem Tag="Grid" IsSelected="True" >
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="{StaticResource FontAwesome}" Text="&#xf009;" Margin="0,0,8,0" FontSize="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="Grid "/>
                                </StackPanel>
                            </ComboBoxItem>
                            <ComboBoxItem Tag="Tile"  >
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="{StaticResource FontAwesome}" Text="&#xf00a;" Margin="0,0,8,0" FontSize="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="Tile "/>
                                </StackPanel>
                            </ComboBoxItem>
                            <ComboBoxItem Tag="List">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="{StaticResource FontAwesome}" Text="&#xf03a;" Margin="0,0,8,0" FontSize="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="List "/>
                                </StackPanel>
                            </ComboBoxItem>

                            <ComboBoxItem Tag="Details">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="{StaticResource FontAwesome}" Text="&#xf022;" Margin="0,0,8,0" FontSize="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="Details "/>
                                </StackPanel>
                            </ComboBoxItem>
                        </ComboBox>

                <StackPanel x:Name="PageNumberPanel" Grid.Row="3" Orientation="Horizontal"
              HorizontalAlignment="Center"
              Margin="0,10,0,0"
              Spacing="2">
                    <!-- Previous Button -->

                    <Button Style="{StaticResource SmallIconButton}" 
              Visibility="{Binding IsPrevVisible,Mode=TwoWay,Converter={StaticResource BooleanToVisibilityConverter}}"
              Command="{Binding GoToPreviousPageCommand}" VerticalAlignment="Center" >
                        <FontIcon  Glyph="&#xf100;" FontSize="12"  />
                    </Button>
                    <!-- Page Numbers -->

                    <StackPanel x:Name="PageButtonsPanel"
                  Orientation="Horizontal"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  Spacing="2" />

                    <!-- Next Button -->
                    <Button Style="{StaticResource SmallIconButton}"   
              Visibility="{Binding IsNextVisible,Mode=TwoWay,Converter={StaticResource BooleanToVisibilityConverter}}"
              Command="{Binding GoToNextPageCommand}" 
              VerticalAlignment="Center" >
                        <FontIcon  Glyph="&#xf101;" FontSize="12" />
                    </Button>
                </StackPanel>


                <StackPanel x:Name="FooterPanel" Grid.Row="3" Orientation="Horizontal"  VerticalAlignment="Bottom">
                            <TextBlock Text="{Binding AssetCount}"  Foreground="Red" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Border>



        <Rectangle x:Name="HorizontalSplitter" Grid.Row="1" Grid.ColumnSpan="5"  Width="1850" Height="10" Fill="{StaticResource ThemeSecondaryBackgroundColor}"   
                    IsHitTestVisible="True"  
                    PointerPressed="HorizontalSplitter_PointerPressed"
                    PointerMoved="HorizontalSplitter_PointerMoved"
                    PointerReleased="Splitter_PointerReleased"
                    PointerEntered="HorizontalSplitter_PointerEntered"
                    PointerExited="HorizontalSplitter_PointerExited"/>

        <Border x:Name="BottomPanel" Grid.Row="2" Grid.ColumnSpan="5"   Height="500" Width="1850"  >
                    <StackPanel Orientation="Vertical" VerticalAlignment="Top">
                        <TextBlock Text="File History" FontWeight="SemiBold"></TextBlock>
                        <NavigationView x:Name="NavFileHistory" 
                             PaneDisplayMode="Top"
                             IsBackButtonVisible="Collapsed"
                             IsBackEnabled="False"
                             IsSettingsVisible="False"
                             SelectionChanged="NavFileHistory_SelectionChanged"
                             Loaded="NavFileHistory_Loaded"
                             ItemInvoked="NavFileHistory_ItemInvoked"
                             BackRequested="NavFileHistory_BackRequested"
                             VerticalAlignment="Top">
                            <NavigationView.MenuItems >
                                <NavigationViewItem  Content="Upload Status" Tag="UploadHistory" />
                                <NavigationViewItem  Content="Download Status" Tag="DownloadHistory" />
                                <NavigationViewItem  Content="Export Status" Tag="ExportHistory" />
                            </NavigationView.MenuItems>
                            <ScrollViewer Height="1000" VerticalAlignment="Top">
                                <Frame x:Name="ContentFrame" IsTabStop="True" VerticalAlignment="Top">
                                </Frame>
                            </ScrollViewer>
                        </NavigationView>
                    </StackPanel>
                </Border>
    </Grid>
</Page>
